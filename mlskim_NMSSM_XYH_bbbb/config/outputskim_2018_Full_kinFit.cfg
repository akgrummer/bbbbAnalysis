[configuration]
year='2018'
directory=['2018']
samples=['Data', 'Data_AntiBtag', 'Data_Plus', 'Data_Plus_AntiBtag']
# seed = 2019

# skimFolder="/store/user/fravera/bbbb_ntuples/fullSubmission_2018_v27/SKIM_JetHT_Data/output/"
skimFolder="/store/user/agrummer/bbbb_ntuples/fullSubmission_2018_v27/SKIM_JetHT_Data/output/"
skimFolderMW="/store/user/agrummer/bbbb_ntuples/fullSubmission_2018_v27_BDTsyst/SKIM_massWindow/"

# backgroundWeightName = "PtRegressedAndHigherLevel_kinFit_nTree_500_lRate_005"
# backgroundWeightName = "PtRegressedAndHigherLevel_kinFit_nTree_500_aidan_2021Dec8"
# backgroundWeightName = "quick"
# backgroundWeightName = "MassWindow_mx600my400_2022Feb7"
# backgroundWeightName = "MassWindow_mx600my400_2022Feb7_ptX"
# backgroundWeightName = "MassWindow_mx600my400_2022Mar2_only_mXmY"
# backgroundWeightName = "MassWindow_mx600my400_2022Mar2_without_mXmY"
# backgroundWeightName = "BDTweights_MassWindow_2022Apr11_seed2020"
# backgroundWeightName = "BDTweights_MassWindow_2022Jun21_Nom"
# backgroundWeightName = "BDTweights_MassWindow_2022Jun21_Nom_bJetScoreLoose"
# backgroundWeightName = "BDTweights_MassWindow_2022Apr25" # used in submission on grid
# backgroundWeightName = "BDTweights_MassWindow_2022Apr28RightSide"
# backgroundWeightName = "BDTweights_MassWindow_2022May2_RightSide"
# backgroundWeightName = "BDTweights_MassWindow_2022May2_LeftSide"
# backgroundWeightName = "BDTweights_MassWindow_2022May2_OutHalf"
# backgroundWeightName = "BDTweights_MassWindow_2022May2_InHalf"
# backgroundWeightName = "BDTweights_MassWindow_2022Jun23_OutHalf_bJetScoreLoose"
# backgroundWeightName = "BDTweights_MassWindow_2022Jun23_InHalf_bJetScoreLoose"
# backgroundWeightName = "BDTweights_2022Jul7_bJetScoreLoose"
# backgroundWeightName = "BDTweights_2022Jul14_bJetScore1p5"
# backgroundWeightName = "BDTweights_MassWindow_2022May24_ExcRightOut"
# backgroundWeightName = "BDTweights_MassWindow_2022May24_ExcLeftOut"
# backgroundWeightName = "BDTweights_MassWindow_2022Jun14_InQtr"
# backgroundWeightName = "BDTweights_MassWindow_2022Jun14_OutQtr"
# backgroundWeightName = "BDTweights_2022Aug4_MassGroup0"
# backgroundWeightName = "BDTweights_2022Aug4_MassGroup0_bJetLoose_2"
# backgroundWeightName = "BDTweights_2022Sep14_Mx300_bJetLoose_2"
# backgroundWeightName = "BDTweights_2022Sep14_Mx300_bJetLoose_mx280cut"
backgroundWeightName = "BDTweights_2022Sep14_Mx300_bJetLoose_depth2_leafs50"

variables=['IsolatedElectron_pt', 'IsolatedMuon_pt', 'NbJets', 'HLT_PFHT330PT30_QuadPFJet_75_60_45_40_TriplePFBTagDeepCSV_4p5_ObjectMatched', 'HH_m', 'H1_m', 'H2_m', 'HLT_PFHT330PT30_QuadPFJet_75_60_45_40_TriplePFBTagDeepCSV_4p5_Fired', 'H1_kinFit_m', 'HH_kinFit_m', 'H1_b1_deepCSV', 'H1_b2_deepCSV', 'H2_b1_deepCSV', 'H2_b2_deepCSV']
#variables used for checking the event

trainingVariables = ['H1_b1_kinFit_ptRegressed', 'H1_b2_kinFit_ptRegressed', 'H2_b1_ptRegressed', 'H2_b2_ptRegressed','H1_kinFit_pt', 'H2_pt', 'H1_kinFit_eta', 'H2_eta', 'HH_kinFit_m', 'H1_kinFit_bb_DeltaR', 'H2_bb_DeltaR', 'H2_m', 'distanceFromDiagonal',  'HH_kinFit_pt']
# trainingVariables = ['H1_b1_kinFit_ptRegressed', 'H1_b2_kinFit_ptRegressed', 'H2_b1_ptRegressed', 'H2_b2_ptRegressed','H1_kinFit_pt', 'H2_pt', 'H1_kinFit_eta', 'H2_eta', 'H1_kinFit_bb_DeltaR', 'H2_bb_DeltaR', 'distanceFromDiagonal']
# trainingVariables = ['HH_kinFit_m', 'H2_m']
# trainingVariables = ['H1_b1_ptRegressed']

# n_estimators=args[0], learning_rate=args[1], max_depth=args[2], min_samples_leaf=args[3],gb_args={'subsample': args[4]}
# analysisBackgroundArgument = [500,0.05,4,300,0.6,2020]
analysisBackgroundArgument = [500,0.05,2,50,0.6,2020]
analysisClassifierArgument = [100,0.1,2020]

minbjetpt=40
minbjetregressedpt=40
minbjeteta=-2.5
maxbjeteta=2.5

# selection="fullRegion"
preSelection           = "IsolatedElectron_pt<15 & IsolatedMuon_pt<10 & ((HLT_PFHT330PT30_QuadPFJet_75_60_45_40_TriplePFBTagDeepCSV_4p5_Fired==1 & HLT_PFHT330PT30_QuadPFJet_75_60_45_40_TriplePFBTagDeepCSV_4p5_ObjectMatched>0))"
controlRegionSelection = "( H2_m > 145 | H2_m < 105 ) & ( ( (H1_m > 65) & (H1_m < 95) ) | ( (H1_m > 155) & (H1_m < 185 ) ) )"
controlRegionSelectionLeftSide = "( H2_m > 145 | H2_m < 105 ) & ( (H1_m > 65) & (H1_m < 95) )"
controlRegionSelectionRightSide = "( H2_m > 145 | H2_m < 105 ) &  ( (H1_m > 155) & (H1_m < 185 ) )"
controlRegionSelectionOutHalf = "( H2_m > 145 | H2_m < 105 ) & ( ( (H1_m > 65) & (H1_m < 80) ) | ( (H1_m > 170) & (H1_m < 185 ) ) )"
controlRegionSelectionInHalf = "( H2_m > 145 | H2_m < 105 ) & ( ( (H1_m >= 80) & (H1_m < 95) ) | ( (H1_m > 155) & (H1_m <= 170 ) ) )"
controlRegionSelectionInQtr = "( H2_m > 145 | H2_m < 105 ) & ( ( (H1_m >= 87.5) & (H1_m < 95) ) | ( (H1_m > 155) & (H1_m <= 162.5 ) ) )"
controlRegionSelectionOutQtr = "( H2_m > 145 | H2_m < 105 ) & ( ( (H1_m >= 80) & (H1_m < 87.5) ) | ( (H1_m > 162.5) & (H1_m <= 170 ) ) )"
controlRegionSelectionExcRightOut = "( H2_m > 145 | H2_m < 105 ) & ( ( (H1_m > 65) & (H1_m < 95) ) | ( (H1_m > 155) & (H1_m < 170 ) ) )"
controlRegionSelectionExcLeftOut  = "( H2_m > 145 | H2_m < 105 ) & ( ( (H1_m > 80) & (H1_m < 95) ) | ( (H1_m > 155) & (H1_m < 185 ) ) )"
bTagSelection          = "NbJets>=4"
antiBTagSelection      = "NbJets==3"
# loose working point:
bTagScoreSelection     = "H1_b1_deepCSV>0.0494 &  H1_b2_deepCSV>0.0494 & H2_b1_deepCSV>0.0494 & H2_b2_deepCSV>0.0494"
# bTagScoreSelection     = "H1_b1_deepCSV>0.15 &  H1_b2_deepCSV>0.15 & H2_b1_deepCSV>0.15 & H2_b2_deepCSV>0.15"
# addSelection           = "( H2_m>=200 & H2_m<=492 ) & ( HH_kinFit_m>=400 & HH_kinFit_m<=704 )"
# addSelection           = "( HH_kinFit_m>=212 & HH_kinFit_m<=800 )"
addSelection           = "( HH_kinFit_m>=212 & HH_kinFit_m<=400 )"
# addSelection           = "( HH_kinFit_m>=280 & HH_kinFit_m<=400 )"

threadNumber=4
